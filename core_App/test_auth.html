<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Autenticación</title>
</head>
<body>
    <h1>Test de Sistema de Autenticación</h1>
    
    <div id="status"></div>
    
    <button onclick="clearTokens()">Limpiar Tokens</button>
    <button onclick="checkTokens()">Verificar Tokens</button>
    <button onclick="testLogin()">Ir a Login</button>
    
    <script>
        function clearTokens() {
            sessionStorage.removeItem('jwt');
            sessionStorage.removeItem('refresh_token');
            document.getElementById('status').innerHTML = '<p style="color: green;">Tokens limpiados</p>';
        }
        
        function checkTokens() {
            const jwt = sessionStorage.getItem('jwt');
            const refresh = sessionStorage.getItem('refresh_token');
            
            let html = '<h3>Estado de Tokens:</h3>';
            html += '<p>JWT: ' + (jwt ? 'Existe' : 'No existe') + '</p>';
            html += '<p>Refresh: ' + (refresh ? 'Existe' : 'No existe') + '</p>';
            
            if (jwt) {
                // Intentar decodificar JWT simple
                try {
                    const parts = jwt.split('.');
                    if (parts.length === 3) {
                        const payload = JSON.parse(atob(parts[1]));
                        const exp = new Date(payload.exp * 1000);
                        html += '<p>Expira: ' + exp.toLocaleString() + '</p>';
                        
                        const now = new Date();
                        const isExpired = now > exp;
                        html += '<p>Estado: ' + (isExpired ? 'EXPIRADO' : 'VÁLIDO') + '</p>';
                    }
                } catch (e) {
                    html += '<p style="color: red;">Error decodificando JWT: ' + e.message + '</p>';
                }
            }
            
            document.getElementById('status').innerHTML = html;
        }
        
        function testLogin() {
            window.location.href = '/Proveedores/acceder/';
        }
        
        // Verificar tokens al cargar
        checkTokens();
    </script>
</body>
</html>